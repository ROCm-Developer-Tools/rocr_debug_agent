# Debug Agent Test User Guide
* Test debug agent with trap instruction in the kernel.
  * `export HSA_TOOLS_LIB=librocr_debug_agent64.so`
  * `export LD_LIBRARY_PATH=/path/to/librocr_debug_agent64.so (If it is not at the default locatioin /opt/rocm/lib)`
  * Include llvm-objdump in `$PATH`. (If it is not at the default location /opt/rocm/opencl/bin/x86_64/, llvm-objdump needs to support target “amdgcn - AMD GCN GPUs”).
  * `make`
  * `./rocr_debug_agent_test`

* A sample print out debug agent trap instruction test
```
  *** Debug Agent Test: VectorAddDebugTrapTest ***
[rocr debug agent]:
Queue error state in GPU agent: AMD gfx900
Node: 1
Queue ID: 35786752 (Debug trap;)


64 wavefront(s) found in @PC: 0x0000001101C01308
printing the first one:

   EXEC: 0xFFFFFFFFFFFFFFFF
 STATUS: 0x00012460
TRAPSTS: 0x20000000
     M0: 0x80000000

     s0: 0x0221D000    s1: 0x00000000    s2: 0x0E000000    s3: 0x00EA4FAC
     s4: 0x00000000    s5: 0x00000000    s6: 0x0221D000    s7: 0x00000000
     s8: 0x02227000    s9: 0x00000000   s10: 0x01984000   s11: 0x00000010
    s12: 0x00000002   s13: 0x03800000   s14: 0x0198C000   s15: 0x00000010
    s16: 0x01994000   s17: 0x00000010   s18: 0x01C02070   s19: 0x00000011
    s20: 0x01994000   s21: 0x00000000   s22: 0x01C02070   s23: 0x00000011
    s24: 0x00003800   s25: 0x0000E000   s26: 0xF7200000   s27: 0x00000010
    s28: 0x00000000   s29: 0x00000000   s30: 0x00000000   s31: 0x00000000

Lane 0x0
     v0: 0x00000012    v1: 0x01994000    v2: 0x01994000    v3: 0x00000010
     v4: 0x00000000    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x00000000   v11: 0x3F800000
Lane 0x1
     v0: 0x00000005    v1: 0x01994004    v2: 0x01994004    v3: 0x00000010
     v4: 0x00000004    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x00000000   v11: 0x3F800000
Lane 0x2
     v0: 0x0000000C    v1: 0x01994008    v2: 0x01994008    v3: 0x00000010
     v4: 0x00000008    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x00000000   v11: 0x3F800000
Lane 0x3
     v0: 0x00000012    v1: 0x0199400C    v2: 0x0199400C    v3: 0x00000010
     v4: 0x0000000C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x00000000   v11: 0x3F800000
Lane 0x4
     v0: 0x00000003    v1: 0x01994010    v2: 0x01994010    v3: 0x00000010
     v4: 0x00000010    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x5
     v0: 0x00000007    v1: 0x01994014    v2: 0x01994014    v3: 0x00000010
     v4: 0x00000014    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x6
     v0: 0x00000010    v1: 0x01994018    v2: 0x01994018    v3: 0x00000010
     v4: 0x00000018    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x7
     v0: 0x0000000A    v1: 0x0199401C    v2: 0x0199401C    v3: 0x00000010
     v4: 0x0000001C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x8
     v0: 0x00000013    v1: 0x01994020    v2: 0x01994020    v3: 0x00000010
     v4: 0x00000020    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x9
     v0: 0x00000008    v1: 0x01994024    v2: 0x01994024    v3: 0x00000010
     v4: 0x00000024    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0xA
     v0: 0x0000000A    v1: 0x01994028    v2: 0x01994028    v3: 0x00000010
     v4: 0x00000028    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0xB
     v0: 0x0000000C    v1: 0x0199402C    v2: 0x0199402C    v3: 0x00000010
     v4: 0x0000002C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0xC
     v0: 0x0000000A    v1: 0x01994030    v2: 0x01994030    v3: 0x00000010
     v4: 0x00000030    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0xD
     v0: 0x0000000B    v1: 0x01994034    v2: 0x01994034    v3: 0x00000010
     v4: 0x00000034    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0xE
     v0: 0x00000005    v1: 0x01994038    v2: 0x01994038    v3: 0x00000010
     v4: 0x00000038    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0xF
     v0: 0x00000009    v1: 0x0199403C    v2: 0x0199403C    v3: 0x00000010
     v4: 0x0000003C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x10
     v0: 0x00000006    v1: 0x01994040    v2: 0x01994040    v3: 0x00000010
     v4: 0x00000040    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x11
     v0: 0x0000000A    v1: 0x01994044    v2: 0x01994044    v3: 0x00000010
     v4: 0x00000044    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x12
     v0: 0x00000003    v1: 0x01994048    v2: 0x01994048    v3: 0x00000010
     v4: 0x00000048    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x13
     v0: 0x0000000A    v1: 0x0199404C    v2: 0x0199404C    v3: 0x00000010
     v4: 0x0000004C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x14
     v0: 0x0000000C    v1: 0x01994050    v2: 0x01994050    v3: 0x00000010
     v4: 0x00000050    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x15
     v0: 0x00000013    v1: 0x01994054    v2: 0x01994054    v3: 0x00000010
     v4: 0x00000054    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x16
     v0: 0x00000008    v1: 0x01994058    v2: 0x01994058    v3: 0x00000010
     v4: 0x00000058    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x17
     v0: 0x0000000F    v1: 0x0199405C    v2: 0x0199405C    v3: 0x00000010
     v4: 0x0000005C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x18
     v0: 0x00000006    v1: 0x01994060    v2: 0x01994060    v3: 0x00000010
     v4: 0x00000060    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x19
     v0: 0x0000000F    v1: 0x01994064    v2: 0x01994064    v3: 0x00000010
     v4: 0x00000064    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x1A
     v0: 0x00000007    v1: 0x01994068    v2: 0x01994068    v3: 0x00000010
     v4: 0x00000068    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x1B
     v0: 0x0000000B    v1: 0x0199406C    v2: 0x0199406C    v3: 0x00000010
     v4: 0x0000006C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x1C
     v0: 0x0000000F    v1: 0x01994070    v2: 0x01994070    v3: 0x00000010
     v4: 0x00000070    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x1D
     v0: 0x00000008    v1: 0x01994074    v2: 0x01994074    v3: 0x00000010
     v4: 0x00000074    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x1E
     v0: 0x00000006    v1: 0x01994078    v2: 0x01994078    v3: 0x00000010
     v4: 0x00000078    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x1F
     v0: 0x0000000F    v1: 0x0199407C    v2: 0x0199407C    v3: 0x00000010
     v4: 0x0000007C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x20
     v0: 0x0000000C    v1: 0x01994080    v2: 0x01994080    v3: 0x00000010
     v4: 0x00000080    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x21
     v0: 0x0000000B    v1: 0x01994084    v2: 0x01994084    v3: 0x00000010
     v4: 0x00000084    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x22
     v0: 0x00000004    v1: 0x01994088    v2: 0x01994088    v3: 0x00000010
     v4: 0x00000088    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x23
     v0: 0x0000000E    v1: 0x0199408C    v2: 0x0199408C    v3: 0x00000010
     v4: 0x0000008C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x24
     v0: 0x0000000A    v1: 0x01994090    v2: 0x01994090    v3: 0x00000010
     v4: 0x00000090    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x25
     v0: 0x0000000D    v1: 0x01994094    v2: 0x01994094    v3: 0x00000010
     v4: 0x00000094    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x26
     v0: 0x00000007    v1: 0x01994098    v2: 0x01994098    v3: 0x00000010
     v4: 0x00000098    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x27
     v0: 0x00000008    v1: 0x0199409C    v2: 0x0199409C    v3: 0x00000010
     v4: 0x0000009C    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x28
     v0: 0x0000000A    v1: 0x019940A0    v2: 0x019940A0    v3: 0x00000010
     v4: 0x000000A0    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x29
     v0: 0x00000014    v1: 0x019940A4    v2: 0x019940A4    v3: 0x00000010
     v4: 0x000000A4    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x2A
     v0: 0x00000012    v1: 0x019940A8    v2: 0x019940A8    v3: 0x00000010
     v4: 0x000000A8    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x2B
     v0: 0x0000000E    v1: 0x019940AC    v2: 0x019940AC    v3: 0x00000010
     v4: 0x000000AC    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x2C
     v0: 0x0000000D    v1: 0x019940B0    v2: 0x019940B0    v3: 0x00000010
     v4: 0x000000B0    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x2D
     v0: 0x00000005    v1: 0x019940B4    v2: 0x019940B4    v3: 0x00000010
     v4: 0x000000B4    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x2E
     v0: 0x00000010    v1: 0x019940B8    v2: 0x019940B8    v3: 0x00000010
     v4: 0x000000B8    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x2F
     v0: 0x0000000B    v1: 0x019940BC    v2: 0x019940BC    v3: 0x00000010
     v4: 0x000000BC    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x30
     v0: 0x00000010    v1: 0x019940C0    v2: 0x019940C0    v3: 0x00000010
     v4: 0x000000C0    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x31
     v0: 0x0000000E    v1: 0x019940C4    v2: 0x019940C4    v3: 0x00000010
     v4: 0x000000C4    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x32
     v0: 0x0000000E    v1: 0x019940C8    v2: 0x019940C8    v3: 0x00000010
     v4: 0x000000C8    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x33
     v0: 0x00000005    v1: 0x019940CC    v2: 0x019940CC    v3: 0x00000010
     v4: 0x000000CC    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x34
     v0: 0x0000000F    v1: 0x019940D0    v2: 0x019940D0    v3: 0x00000010
     v4: 0x000000D0    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x35
     v0: 0x00000007    v1: 0x019940D4    v2: 0x019940D4    v3: 0x00000010
     v4: 0x000000D4    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x36
     v0: 0x00000008    v1: 0x019940D8    v2: 0x019940D8    v3: 0x00000010
     v4: 0x000000D8    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x37
     v0: 0x00000004    v1: 0x019940DC    v2: 0x019940DC    v3: 0x00000010
     v4: 0x000000DC    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x38
     v0: 0x00000013    v1: 0x019940E0    v2: 0x019940E0    v3: 0x00000010
     v4: 0x000000E0    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x39
     v0: 0x00000009    v1: 0x019940E4    v2: 0x019940E4    v3: 0x00000010
     v4: 0x000000E4    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x3A
     v0: 0x0000000E    v1: 0x019940E8    v2: 0x019940E8    v3: 0x00000010
     v4: 0x000000E8    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x3B
     v0: 0x0000000C    v1: 0x019940EC    v2: 0x019940EC    v3: 0x00000010
     v4: 0x000000EC    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x3C
     v0: 0x0000000D    v1: 0x019940F0    v2: 0x019940F0    v3: 0x00000010
     v4: 0x000000F0    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x3D
     v0: 0x00000008    v1: 0x019940F4    v2: 0x019940F4    v3: 0x00000010
     v4: 0x000000F4    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x3E
     v0: 0x00000007    v1: 0x019940F8    v2: 0x019940F8    v3: 0x00000010
     v4: 0x000000F8    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000
Lane 0x3F
     v0: 0x0000000E    v1: 0x019940FC    v2: 0x019940FC    v3: 0x00000010
     v4: 0x000000FC    v5: 0x00000000    v6: 0x00000010    v7: 0x00000010
     v8: 0x00000000    v9: 0x3F800000   v10: 0x3F800000   v11: 0x3F800000

Code Object:

/tmp/ROCm_Tmp_PID_32443/ROCm_Code_Object_0:     file format ELF64-amdgpu

Disassembly of section .text:
vector_add_debug_trap:
; /home/qingchuan/workspace/rocr_debug_agent/test/vector_add_debug_trap_kernel.cl:7
; c[gid] = a[gid] + b[gid];
        v_cndmask_b32_e32 v1, v1, v6, vcc                          // 0000000012E8: 00020D01
        v_addc_co_u32_e64 v6, s[4:5], v7, v8, s[4:5]               // 0000000012EC: D11C0406 00121107
        v_mov_b32_e32 v2, v1                                       // 0000000012F4: 7E040301
        v_mov_b32_e32 v3, v6                                       // 0000000012F8: 7E060306
        global_store_dword v[2:3], v0, off                         // 0000000012FC: DC708000 007F0002
; /home/qingchuan/workspace/rocr_debug_agent/test/vector_add_debug_trap_kernel.cl:8
; __builtin_trap();
        s_mov_b64 s[0:1], s[6:7]                                   // 000000001304: BE800106
        s_trap 2                                                   // 000000001308: BF920002
; /home/qingchuan/workspace/rocr_debug_agent/test/vector_add_debug_trap_kernel.cl:9
; }
        s_endpgm                                                   // 00000000130C: BF810000

PC offset: 1308

runtime catched trap instruction successfully
custom queue error handler completed successfully
  **************************
Test Finished
  **************************
```

